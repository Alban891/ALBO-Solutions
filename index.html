<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALBO Solutions - Business Case Management Platform</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- ========================================== -->
    <!-- HEADER -->
    <!-- ========================================== -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>ALBO Solutions - Business Case Management</h1>
            <span class="header-subtitle">KI-gest√ºtzte Echtzeit-Analyse mit intelligenten Handlungsempfehlungen</span>
        </div>
        <!-- RECHTS: KPIs -->
        <div class="header-stats">
            <div class="stat">
                <div class="stat-value" id="npv-value">+44,7M‚Ç¨</div>
                <div class="stat-label">NPV (9 JAHRE)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="payback-value">3,4J</div>
                <div class="stat-label">PAYBACK</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="revenue-value">117,8M‚Ç¨</div>
                <div class="stat-label">TOTAL REVENUE</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="margin-value">34%</div>
                <div class="stat-label">√ò DB2-MARGE</div>
            </div>
        </div>
    </header>

    <!-- ========================================== -->
    <!-- MAIN NAVIGATION (Horvath-Style) -->
    <!-- ========================================== -->
    <nav class="main-navigation">
        <button class="tab-btn active" onclick="switchTab('cockpit')">
            üìä Cockpit
        </button>
        <button class="tab-btn" onclick="switchTab('projekte')">
            üíº Projekte
        </button>
        <button class="tab-btn" onclick="switchTab('performance')">
            üìà Performance
        </button>
        <button class="tab-btn" onclick="switchTab('admin')">
            ‚öôÔ∏è Admin
        </button>
    </nav>

    <!-- ========================================== -->
    <!-- MAIN CONTENT WRAPPER -->
    <!-- ========================================== -->
    <div class="main-content">
        <main class="dashboard-main">

            <!-- ========================================== -->
            <!-- TAB 1: COCKPIT (Portfolio Overview) -->
            <!-- ========================================== -->
            <div id="tab-cockpit" class="tab-content active">
                
                <!-- Slider Controls -->
                <div class="control-panel">
                    <h2>üéõÔ∏è Business Case Simulator</h2>
                    <p class="control-description">Passen Sie die Annahmen an und sehen Sie die Auswirkungen in Echtzeit</p>

                    <div class="sliders-grid">
                        <!-- Market Volume Slider -->
                        <div class="slider-control">
                            <div class="slider-header">
                                <label>üìà Marktvolumen</label>
                                <span id="market-value" class="slider-value">100%</span>
                            </div>
                            <input type="range" id="market-slider" 
                                   min="50" max="150" value="100" step="5"
                                   oninput="adjustAssumption('market', this.value)"
                                   class="slider">
                            <div class="slider-labels">
                                <span>50%</span>
                                <span>100%</span>
                                <span>150%</span>
                            </div>
                        </div>

                        <!-- Price Premium Slider -->
                        <div class="slider-control">
                            <div class="slider-header">
                                <label>üí∞ Preis-Premium</label>
                                <span id="price-value" class="slider-value">+0%</span>
                            </div>
                            <input type="range" id="price-slider" 
                                   min="80" max="120" value="100" step="5"
                                   oninput="adjustAssumption('price', this.value)"
                                   class="slider">
                            <div class="slider-labels">
                                <span>-20%</span>
                                <span>¬±0%</span>
                                <span>+20%</span>
                            </div>
                        </div>

                        <!-- CAPEX Risk Slider -->
                        <div class="slider-control">
                            <div class="slider-header">
                                <label>‚ö†Ô∏è CAPEX-Risiko</label>
                                <span id="capex-value" class="slider-value">Plan</span>
                            </div>
                            <input type="range" id="capex-slider" 
                                   min="80" max="120" value="100" step="5"
                                   oninput="adjustAssumption('capex', this.value)"
                                   class="slider">
                            <div class="slider-labels">
                                <span>-20%</span>
                                <span>Plan</span>
                                <span>+20%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">üí∞</div>
                        <div class="metric-content">
                            <div class="metric-label">NPV</div>
                            <div class="metric-value">44.7 M‚Ç¨</div>
                            <div class="metric-change positive">+12.3% vs Plan</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">üìÖ</div>
                        <div class="metric-content">
                            <div class="metric-label">Payback</div>
                            <div class="metric-value">3.4 Jahre</div>
                            <div class="metric-change positive">Excellent</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-content">
                            <div class="metric-label">Gesamt-Umsatz</div>
                            <div class="metric-value">174.0 M‚Ç¨</div>
                            <div class="metric-change neutral">2024-2030</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon">üíé</div>
                        <div class="metric-content">
                            <div class="metric-label">DB2-Marge</div>
                            <div class="metric-value">34%</div>
                            <div class="metric-change positive">√úber Benchmark</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Umsatz Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üìà Umsatzentwicklung</h3>
                            <span class="chart-subtitle">J√§hrliche Erl√∂se in k‚Ç¨</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="umsatz-chart"></canvas>
                        </div>
                    </div>

                    <!-- Absatz Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üì¶ Absatzentwicklung</h3>
                            <span class="chart-subtitle">Verkaufte Einheiten (Tsd.)</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="absatz-chart"></canvas>
                        </div>
                    </div>

                    <!-- DB2 Chart -->
                    <div class="chart-card chart-wide">
                        <div class="chart-header">
                            <h3>üí∞ DB2 & Marge</h3>
                            <span class="chart-subtitle">Deckungsbeitrag II und Margenverlauf</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="db2-chart"></canvas>
                        </div>
                    </div>

                    <!-- Projektkosten Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üîß Projektkosten</h3>
                            <span class="chart-subtitle">Entwicklungs- und Betriebskosten</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="projektkosten-chart"></canvas>
                        </div>
                    </div>

                    <!-- DB3 Jahr Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üíé DB3 Jahreswerte</h3>
                            <span class="chart-subtitle">Deckungsbeitrag III pro Jahr</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="db3-jahr-chart"></canvas>
                        </div>
                    </div>

                    <!-- DB3 Kumuliert Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>üìà DB3 Kumuliert</h3>
                            <span class="chart-subtitle">Kumulierter Deckungsbeitrag</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="db3-kumuliert-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- TAB 2: PROJEKTE -->
            <!-- ========================================== -->
            <div id="tab-projekte" class="tab-content">
                
                <!-- ========================================== -->
                <!-- VIEW: PROJEKT OVERVIEW (Default) -->
                <!-- ========================================== -->
                <div id="projekt-overview">
                    
                    <!-- Portfolio Overview Header (Horvath Style) -->
                    <div class="portfolio-overview-header">
                        <div class="portfolio-label">PORTFOLIO OVERVIEW</div>
                        <div class="portfolio-stats">
                            <div class="portfolio-stat">
                                <span class="portfolio-stat-value" id="stat-total-projects">0</span>
                                <span class="portfolio-stat-label">PROJEKTE</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-success">
                                <span class="portfolio-stat-value" id="stat-active-projects">0</span>
                                <span class="portfolio-stat-label">AKTIV</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-warning">
                                <span class="portfolio-stat-value" id="stat-onhold-projects">0</span>
                                <span class="portfolio-stat-label">ON HOLD</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-neutral">
                                <span class="portfolio-stat-value" id="stat-completed-projects">0</span>
                                <span class="portfolio-stat-label">ABGESCHLOSSEN</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section Header with View Switcher -->
                    <div class="section-header-with-views">
                        <div class="section-title">
                            <span class="section-icon">üìÅ</span>
                            <h2>Projekt Portfolio</h2>
                        </div>
                        <div class="view-switcher">
                            <button class="view-btn active" data-view="liste" onclick="switchProjectView('liste')">
                                <span class="view-icon">‚ò∞</span> Liste
                            </button>
                            <button class="view-btn" data-view="karten" onclick="switchProjectView('karten')">
                                <span class="view-icon">‚ñ¶</span> Karten
                            </button>
                            <button class="view-btn" data-view="kompakt" onclick="switchProjectView('kompakt')">
                                <span class="view-icon">‚â°</span> Kompakt
                            </button>
                        </div>
                    </div>

                    <!-- Filter & Search -->
                    <div class="table-controls">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="projekt-search" 
                                   placeholder="Projekte durchsuchen..." 
                                   oninput="filterProjekte()">
                        </div>
                        
                        <div class="filter-group">
                            <label for="projekt-filter-status" class="sr-only">Status Filter</label>
                            <select id="projekt-filter-status" onchange="filterProjekte()" aria-label="Status Filter">
                                <option value="alle">Alle Status</option>
                                <option value="aktiv">Aktiv</option>
                                <option value="planung">Planung</option>
                                <option value="on-hold">On Hold</option>
                                <option value="abgeschlossen">Abgeschlossen</option>
                            </select>

                            <select id="projekt-sort" onchange="sortProjekte()">
                                <option value="name">Sortieren: Name</option>
                                <option value="start">Sortieren: Startdatum</option>
                                <option value="status">Sortieren: Status</option>
                                <option value="owner">Sortieren: Owner</option>
                            </select>
                        </div>
                    </div>

                    <!-- Projects Table -->
                    <div id="projekt-list-container">
                        <div class="table-container">
                            <!-- Loading Indicator -->
                            <div id="projekt-loading-indicator" class="loading-indicator">
                                <div class="spinner"></div>
                                <p>Projekte werden geladen...</p>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="40">
                                            <input type="checkbox" id="select-all-projects" 
                                                    onchange="toggleAllProjects(this)">
                                        </th>
                                        <th>PROJEKT</th>
                                        <th>DIVISION</th>
                                        <th>OWNER</th>
                                        <th width="100">START</th>
                                        <th width="100">END</th>
                                        <th width="100">STATUS</th>
                                        <th width="120">AKTIONEN</th>
                                    </tr>
                                </thead>
                                <tbody id="projekt-list-tbody">
                                    <!-- Projects will be rendered here by projekte.js -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Centered Create Button -->
                    <div class="centered-action">
                        <button class="btn btn-primary btn-large" onclick="openCreateProjektModal()">
                            ‚ûï Neues Projekt anlegen
                        </button>
                    </div>

                    <!-- Bulk Actions Bar -->
                    <div id="bulk-actions-bar" class="bulk-actions-bar">
                        <div class="bulk-actions-info">
                            <span id="bulk-count">0</span> Projekte ausgew√§hlt
                        </div>
                        <div class="bulk-actions-buttons">
                            <select id="bulk-status-change">
                                <option value="">Status √§ndern...</option>
                                <option value="Planung">‚Üí Planung</option>
                                <option value="Aktiv">‚Üí Aktiv</option>
                                <option value="On Hold">‚Üí On Hold</option>
                                <option value="Abgeschlossen">‚Üí Abgeschlossen</option>
                            </select>
                            <button class="btn btn-secondary" onclick="bulkStatusChange()">
                                Anwenden
                            </button>
                            <button class="btn btn-danger" onclick="bulkDeleteProjekte()">
                                üóëÔ∏è L√∂schen
                            </button>
                        </div>
                    </div>

                </div>
                <!-- Ende projekt-overview -->

                <!-- ========================================== -->
                <!-- VIEW: PROJEKT DETAIL (Hidden by default) -->
                <!-- ========================================== -->
                <div id="projekt-detail-view" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="projekt-detail-breadcrumb" class="breadcrumb-current">Projekt</span>
                    </div>

                    <!-- Header -->
                    <div class="section-header">
                        <h2 id="projekt-detail-title">Projekt</h2>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="backToProjektOverview()">
                                ‚Üê Zur√ºck
                            </button>
                        </div>
                    </div>

                    <!-- TAB-NAVIGATION INNERHALB PROJEKT -->
                    <div class="detail-tabs">
                        <button class="detail-tab" onclick="switchProjektTab('uebersicht')">
                            üìã √úbersicht
                        </button>
                        <button class="detail-tab active" onclick="switchProjektTab('artikel')">
                            üì¶ Artikel
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('projektkosten')">
                            üí∞ Projektkosten
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('wirtschaftlichkeit')">
                            üìà Wirtschaftlichkeit
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('dashboard')">
                            üìä Dashboard
                        </button>
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: √úBERSICHT -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-uebersicht" class="projekt-tab-content active">
                        <div class="form-section">
                            <h3>üìã Projekt-Stammdaten</h3>
                            <p style="color: var(--gray); margin-top: 8px;">
                                Hier werden die Projekt-Basisinformationen angezeigt (Coming Soon)
                            </p>
                            
                            <div style="margin-top: 24px; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                <h4 style="margin: 0 0 12px 0;">üéØ Quick Facts</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <div>
                                        <div style="font-size: 12px; color: var(--gray);">Status</div>
                                        <div style="font-size: 16px; font-weight: 500; margin-top: 4px;">Aktiv</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--gray);">Owner</div>
                                        <div style="font-size: 16px; font-weight: 500; margin-top: 4px;">Max Mustermann</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--gray);">Laufzeit</div>
                                        <div style="font-size: 16px; font-weight: 500; margin-top: 4px;">Q1 2025 - Q4 2027</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 12px; color: var(--gray);">Artikel</div>
                                        <div style="font-size: 16px; font-weight: 500; margin-top: 4px;">3 Artikel</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: KOSTEN (Your existing design!) -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-projektkosten" class="projekt-tab-content">
                        
                        <div class="section-header">
                            <h3>üí∞ Projektkosten</h3>
                            <div class="header-actions">
                                <button class="btn btn-secondary" onclick="generateKostenEmpfehlungen()">
                                    ü§ñ KI-Empfehlungen
                                </button>
                                <button class="btn btn-primary" onclick="addKostenBlock()">
                                    ‚ûï Kostenblock
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px; padding: 16px; background: var(--bg-secondary); border-left: 4px solid var(--primary); border-radius: 4px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 24px;">‚ÑπÔ∏è</span>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Projektkosten-Verwaltung</div>
                                    <div style="font-size: 14px; color: var(--gray);">
                                        Diese Kosten gelten f√ºr <strong>alle Artikel</strong> in diesem Projekt.
                                        Nutzen Sie die KI-Empfehlungen f√ºr typische Kostenstrukturen.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Blocks Container (from kosten.js) -->
                        <div id="kosten-bloecke-container" class="kosten-bloecke">
                            <!-- Cost blocks will be added here dynamically by kosten.js -->
                        </div>

                        <!-- Total -->
                        <div class="kosten-total">
                            <div class="kosten-total-label">Gesamte Projektkosten:</div>
                            <div class="kosten-total-value" id="total-projektkosten">0‚Ç¨</div>
                        </div>

                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: ARTIKEL -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-artikel" class="projekt-tab-content">
                        
                        <!-- Header -->
                        <div class="section-header">
                            <div>
                                <h3>üì¶ Artikel</h3>
                                <p>Produktartikel und Services des Projekts</p>
                            </div>
                            <button class="btn btn-primary" onclick="createNewArtikel()">
                                ‚ûï Neuer Artikel
                            </button>
                        </div>

                        <!-- Articles Table -->
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="40">
                                            <input type="checkbox" id="select-all-artikel-projekt" 
                                                   onchange="toggleAllArtikelProjekt(this)">
                                        </th>
                                        <th>Artikelname</th>
                                        <th>Kategorie</th>
                                        <th>Release</th>
                                        <th>Umsatz</th>
                                        <th>DB2 %</th>
                                        <th>Status</th>
                                        <th width="150">Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="projekt-artikel-list-tbody">
                                    <!-- Articles will be rendered here by artikel.js -->
                                </tbody>
                            </table>
                        </div>

                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: DASHBOARD -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-dashboard" class="projekt-tab-content">
                        <div class="form-section">
                            <h3>üìä Projekt-Dashboard</h3>
                            <p style="color: var(--gray); margin-top: 8px;">
                                Hier werden alle Charts f√ºr dieses spezifische Projekt angezeigt (Coming Soon)
                            </p>
                            
                            <div class="insights-placeholder">
                                <div class="placeholder-icon">üìä</div>
                                <h4>Charts & Analysen</h4>
                                <p>Bald verf√ºgbar: Projekt-spezifische Dashboards mit allen relevanten Kennzahlen und Diagrammen.</p>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: BUSINESS CASE -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-business-case" class="projekt-tab-content">
                        <div class="form-section">
                            <h3>ü§ñ Business Case Empfehlung</h3>
                            <p style="color: var(--gray); margin-top: 8px;">
                                KI-basierte Analyse und Empfehlung (Coming Soon)
                            </p>
                            
                            <div class="insights-placeholder">
                                <div class="placeholder-icon">ü§ñ</div>
                                <h4>KI-Analyse</h4>
                                <p>Bald verf√ºgbar: Automatische Business Case Bewertung, Risiko-Analyse, Benchmark-Vergleich und Go/No-Go Empfehlung.</p>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- Ende projekt-detail-view -->

                <!-- ========================================== -->
                <!-- VIEW: ARTIKEL OVERVIEW (When projekt selected) -->
                <!-- ========================================== -->
                <div id="artikel-overview" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="current-projekt-name" class="breadcrumb-current">Projekt</span>
                    </div>

                    <!-- Header -->
                    <div class="section-header">
                        <div>
                            <h2>üì¶ Artikel</h2>
                            <p>Produktartikel und Services des Projekts</p>
                        </div>
                        <button class="btn btn-primary" onclick="createNewArtikel()">
                            ‚ûï Neuer Artikel
                        </button>
                    </div>

                    <!-- Articles Table -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" id="select-all-artikel" 
                                               onchange="toggleAllArtikel(this)">
                                    </th>
                                    <th>Artikelname</th>
                                    <th>Kategorie</th>
                                    <th>Release</th>
                                    <th>Umsatz</th>
                                    <th>DB2 %</th>
                                    <th>Status</th>
                                    <th width="150">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="artikel-list-tbody">
                                <!-- Articles will be rendered here by artikel.js -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Bulk Actions -->
                    <div id="artikel-bulk-actions-bar" class="bulk-actions-bar">
                        <div class="bulk-actions-info">
                            <span id="artikel-bulk-count">0</span> Artikel ausgew√§hlt
                        </div>
                        <div class="bulk-actions-buttons">
                            <button class="btn btn-danger" onclick="bulkDeleteArtikel()">
                                üóëÔ∏è L√∂schen
                            </button>
                        </div>
                    </div>

                </div>
                <!-- Ende artikel-overview -->

                <!-- ========================================== -->
                <!-- VIEW: ARTIKEL DETAIL (Hidden by default) -->
                <!-- ========================================== -->
                <div id="artikel-detail-view" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="artikel-breadcrumb-projekt" class="breadcrumb-current">Projekt</span>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <button class="breadcrumb-link" onclick="closeArtikelDetail()">
                            üì¶ Artikel
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="artikel-breadcrumb-name" class="breadcrumb-current">Artikel bearbeiten</span>
                    </div>

                    <div id="artikel-update-info" style="
                        display: none;
                        padding: 10px 16px;
                        background: rgba(16, 185, 129, 0.1);
                        border-left: 3px solid var(--success);
                        border-radius: 4px;
                        margin-bottom: 16px;
                        font-size: 13px;
                        color: var(--text);
                    ">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>

                    <!-- TAB-NAVIGATION F√úR ARTIKEL -->
                    <div class="detail-tabs">
                        <button class="detail-tab active" onclick="switchArtikelTab('artikel')">
                            üì¶ Artikel
                        </button>
                        <button class="detail-tab" onclick="switchArtikelTab('projekte')">
                            üí∞ Projekte
                        </button>
                        <button class="detail-tab" onclick="switchArtikelTab('wirtschaftlichkeit')">
                            üìà Wirtschaftlichkeit
                        </button>
                    </div>

                    <!-- TAB CONTENT: ARTIKEL -->
                    <div id="artikel-tab-artikel" class="artikel-tab-content active">

                    <!-- Header mit Navigation -->
                    <div class="section-header" style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <button class="btn btn-secondary" onclick="closeArtikelDetail()" 
                                    style="display: flex; align-items: center; gap: 8px;">
                                ‚Üê Zur√ºck zur Artikel-√úbersicht
                            </button>

                            <div style="display: flex; align-items: center; gap: 12px; margin-left: auto;">
                                <button class="btn btn-secondary btn-sm" onclick="navigateToPreviousArtikel()" 
                                        id="prev-artikel-btn" style="display: flex; align-items: center; gap: 4px;">
                                    ‚óÄ Vorheriger
                                </button>
                    
                                <div style="padding: 8px 16px; background: var(--bg-secondary); border-radius: 6px; font-size: 14px; font-weight: 500;">
                                    Artikel <span id="artikel-position">1</span> von <span id="artikel-total">3</span>
                                </div>
                    
                                <button class="btn btn-secondary btn-sm" onclick="navigateToNextArtikel()" 
                                        id="next-artikel-btn" style="display: flex; align-items: center; gap: 4px;">
                                    N√§chster ‚ñ∂
                                </button>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 16px;">
                            <h2 id="artikel-detail-title" style="margin: 0; flex: 1;">‚úèÔ∏è Artikel bearbeiten</h2>
                            <button class="btn btn-secondary" onclick="closeArtikelDetail()">
                                Abbrechen
                            </button>
                            <button class="btn btn-primary" onclick="saveArtikelChanges()">
                                üíæ Speichern
                            </button>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- ALLE INHALTE AUF EINER SEITE (KEINE TABS!) -->
                    <!-- ========================================== -->
                    
                    <!-- Basis-Informationen & Markt -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        
                        <!-- LINKE SPALTE: Basis-Informationen -->
                        <div class="form-section">
                            <h3>üìù Basis-Informationen</h3>
                            
                            <div class="form-group">
                                <label>Artikelname *</label>
                                <input type="text" id="artikel-name" 
                                    placeholder="z.B. Smart Sensor X1" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Typ *</label>
                                    <select id="artikel-typ">
                                        <option value="Hardware">Hardware</option>
                                        <option value="Software">Software</option>
                                        <option value="Service">Service</option>
                                        <option value="Hybrid">Hybrid</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Kategorie</label>
                                    <input type="text" id="kategorie" 
                                        placeholder="z.B. IoT Sensor">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Beschreibung</label>
                                <textarea id="artikel-beschreibung" rows="3" 
                                        placeholder="Kurze Produktbeschreibung..."></textarea>
                            </div>
                        </div>

                        <!-- RECHTE SPALTE: Markt & Strategie -->
                        <div class="form-section">
                            <h3>üéØ Markt & Strategie</h3>

                            <div class="form-group">
                                <label>Gesch√§ftsmodell</label>
                                <select id="geschaeftsmodell">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="einmalverkauf">Einmalverkauf</option>
                                    <option value="subscription">Subscription</option>
                                    <option value="freemium">Freemium</option>
                                    <option value="lizenz">Lizenzmodell</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Zielmarkt</label>
                                <input type="text" id="zielmarkt" 
                                    placeholder="z.B. DACH Region, B2B">
                            </div>

                            <div class="form-group">
                                <label>Strategie</label>
                                <select id="strategie">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="innovator">Innovator/First Mover</option>
                                    <option value="fast-follower">Fast Follower</option>
                                    <option value="cost-leader">Cost Leader</option>
                                    <option value="niche">Nische/Spezialist</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Investment-Typ</label>
                                <select id="investment-typ">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="growth">Growth</option>
                                    <option value="efficiency">Efficiency</option>
                                    <option value="innovation">Innovation</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline & Release -->
                    <div class="form-section" style="margin-bottom: 24px;">
                        <h3>üìÖ Timeline & Release</h3>

                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 24px;">
                            <div class="form-group">
                                <label>Release-Datum (Monat)</label>
                                <input type="month" id="release-datum">
                            </div>

                            <div class="form-group">
                                <label>Annahmen & Risiken</label>
                                <textarea id="annahmen" rows="2" 
                                        placeholder="Wichtige Annahmen zum Artikel..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- WIRTSCHAFTLICHKEIT -->
                    <!-- ========================================== -->
                    
                    <div id="artikel-tab-wirtschaftlichkeit" class="artikel-tab-content">
                        <!-- Wird von wirtschaftlichkeit.js gef√ºllt -->
                    </div>
                    
                <!-- Ende artikel-detail-view -->

            <!-- ========================================== -->
            <!-- TAB 3: PERFORMANCE -->
            <!-- ========================================== -->
            <div id="tab-performance" class="tab-content">
                
                <div class="insights-container">
                    <h2>üìà Performance Controlling</h2>
                    <p>Plan-Ist-Forecast √ºber alle Projekte (Coming Soon)</p>
                    
                    <div class="insights-placeholder">
                        <div class="placeholder-icon">üìä</div>
                        <h3>In Entwicklung</h3>
                        <p>Hier werden bald Plan-Ist-Vergleiche, Rolling Forecasts und Performance-Analysen verf√ºgbar sein.</p>
                    </div>
                </div>

            </div>

            <!-- ========================================== -->
            <!-- TAB 4: ADMIN -->
            <!-- ========================================== -->
            <div id="tab-admin" class="tab-content">
                
                <div class="insights-container">
                    <h2>‚öôÔ∏è Administration</h2>
                    <p>Einstellungen und Stammdaten (Coming Soon)</p>
                    
                    <div class="insights-placeholder">
                        <div class="placeholder-icon">üîß</div>
                        <h3>In Entwicklung</h3>
                        <p>Hier werden bald Einstellungen, Stammdaten-Verwaltung und System-Konfigurationen verf√ºgbar sein.</p>
                    </div>
                </div>

            </div>

        </main>

        <!-- ========================================== -->
        <!-- AI SIDEBAR (Always visible) -->
        <!-- ========================================== -->
        <div class="sidebar">
            <!-- AI Header -->
            <div class="ai-header">
                <div class="ai-status">
                    <div class="ai-status-indicator"></div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">KI-Controller aktiv</div>
                        <div style="font-size: 11px; opacity: 0.9;">Echtzeit-Analyse ‚Ä¢ 1.400+ Finance-Patterns ‚Ä¢ Industrie-Benchmarks</div>
                    </div>
                </div>
            </div>

            <!-- AI Metrics Panel -->
            <div class="ai-metrics-panel">
                <div style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border);">
                    <div style="font-size: 11px; font-weight: 600; color: var(--gray); margin-bottom: 8px;">Business Case Status:</div>
                    <div style="display: inline-block; padding: 4px 12px; background: #d1fae5; color: #065f46; border-radius: 6px; font-size: 12px; font-weight: 600;">
                        ‚úì Positiv
                    </div>
                </div>

                <div class="ai-metric-row">
                    <span class="ai-metric-label">Risiko-Level:</span>
                    <span class="ai-metric-value warning">Medium (68%)</span>
                </div>
                <div class="ai-metric-row">
                    <span class="ai-metric-label">Konfidenz-Score:</span>
                    <span class="ai-metric-value">78%</span>
                </div>
                <div class="ai-metric-row">
                    <span class="ai-metric-label">vs. Industrie-Benchmark:</span>
                    <span class="ai-metric-value good">+12% besser</span>
                </div>
            </div>

            <!-- AI Feed -->
            <div class="ai-feed">
                <div class="ai-feed-title">ü§ñ KI-Insights Feed</div>
                <div id="ki-feed">
                    <!-- Messages werden hier von AI Controller eingef√ºgt -->
                </div>
            </div>
        </div>

    </div> <!-- Ende main-content -->

    <!-- ========================================== -->
    <!-- SCRIPTS -->
    <!-- ========================================== -->
    
    <!-- Load Modules (ES6) -->
    <script type="module">
    // Import all modules
    import './js/main.js';
    import { state } from './js/state.js';
    import * as helpers from './js/helpers.js';
    import { renderProjektOverview, updateProjektStats } from './js/modules/projekte.js';
    import { renderArtikelListByProjekt } from './js/modules/artikel.js';
    
    // Make modules globally available for inline handlers
    window.state = state;
    window.helpers = helpers;
    window.renderProjektOverview = renderProjektOverview;
    window.updateProjektStats = updateProjektStats;
    window.renderArtikelListByProjekt = renderArtikelListByProjekt;

    // NEW: Projekt-Tab switching function
    window.switchProjektTab = function(tabName) {
        console.log('üìë Switching projekt tab:', tabName);

        // Update tab buttons
        document.querySelectorAll('.detail-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Update tab contents
        document.querySelectorAll('.projekt-tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Activate target tab
        const targetButton = document.querySelector(`[onclick="switchProjektTab('${tabName}')"]`);
        const targetContent = document.getElementById(`projekt-tab-${tabName}`);

        if (targetButton) targetButton.classList.add('active');
        if (targetContent) targetContent.classList.add('active');

        // Special handling for artikel tab
        if (tabName === 'artikel') {
            // Render artikel list for this projekt
            const projektId = window.cfoDashboard.currentProjekt;
            if (projektId) {
                const tbody = document.getElementById('projekt-artikel-list-tbody');
                if (tbody) {
                    // Use artikel.js function to render
                    renderArtikelListByProjekt();
                    // Copy to projekt tab tbody
                    const sourceBody = document.getElementById('artikel-list-tbody');
                    if (sourceBody) {
                        tbody.innerHTML = sourceBody.innerHTML;
                    }
                }
            }
        }
        else if (tabName === 'projektkosten') {
            // Import und render Projektkosten
            import('./js/modules/projektkosten.js').then(module => {
                module.renderProjektkosten();
            });
        }
    };
    
    // F√ºge diese Funktion nach der switchProjektTab Funktion ein (ca. Zeile 1230)
    window.switchArtikelTab = function(tabName) {
        console.log('üìë Switching artikel tab:', tabName);

        // Update tab buttons
        document.querySelectorAll('#artikel-detail-view .detail-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Update tab contents  
        document.querySelectorAll('.artikel-tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Activate target tab
        const targetButton = document.querySelector(`#artikel-detail-view [onclick="switchArtikelTab('${tabName}')"]`);
        const targetContent = document.getElementById(`artikel-tab-${tabName}`);

        if (targetButton) targetButton.classList.add('active');
        if (targetContent) targetContent.classList.add('active');

        // Special handling for wirtschaftlichkeit tab
        if (tabName === 'wirtschaftlichkeit') {
            import('./js/modules/wirtschaftlichkeit.js').then(module => {
                module.renderWirtschaftlichkeit();
            });
        }
    };

    // NEW: Artikel-Tab switching function (replaces switchDetailTab)
    window.switchArtikelTab = function(tabName) {
        console.log('üìë Switching artikel tab:', tabName);

        // Update tab buttons
        document.querySelectorAll('#artikel-detail-view .detail-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Update tab contents
        document.querySelectorAll('.artikel-tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Activate target tab
        const targetButton = document.querySelector(`#artikel-detail-view [onclick="switchArtikelTab('${tabName}')"]`);
        const targetContent = document.getElementById(`artikel-tab-${tabName}`);

        if (targetButton) targetButton.classList.add('active');
        if (targetContent) targetContent.classList.add('active');
    };

    // NEW: Navigate to projekt kosten from artikel
    window.navigateToProjektKosten = function() {
        const projektId = window.cfoDashboard.currentProjekt;
        if (!projektId) return;

        // Close artikel detail
        closeArtikelDetail();

        // Open projekt detail
        openProjektDetail(projektId);

        // Switch to kosten tab
        switchProjektTab('kosten');
    };

    // NEW: Open projekt detail view
    window.openProjektDetail = function(projektId) {
        const projekt = window.cfoDashboard.projektData[projektId] || state.getProjekt(projektId);
        if (!projekt) {
            console.error('Projekt not found:', projektId);
            return;
        }

        console.log('üìÇ Opening projekt detail:', projekt.name);

        // Set current projekt
        window.cfoDashboard.currentProjekt = projektId;

        // Hide projekt overview
        const projektOverview = document.getElementById('projekt-overview');
        if (projektOverview) projektOverview.style.display = 'none';

        // Show projekt detail
        const projektDetail = document.getElementById('projekt-detail-view');
        if (projektDetail) projektDetail.style.display = 'block';

        // Update breadcrumb & title
        const breadcrumb = document.getElementById('projekt-detail-breadcrumb');
        const title = document.getElementById('projekt-detail-title');
        if (breadcrumb) breadcrumb.textContent = projekt.name;
        if (title) title.textContent = projekt.name;

        // Switch to first tab
        switchProjektTab('uebersicht');
    };

    console.log('‚úÖ All modules and navigation functions loaded');

    // ==========================================
    // ARTIKEL NAVIGATION (Vorheriger/N√§chster)
    // ==========================================

    /**
     * Navigate to previous artikel
     */
    window.navigateToPreviousArtikel = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) return;
        
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        
        if (currentIndex > 0) {
            const previousArtikel = artikelListe[currentIndex - 1];
            openArtikelDetail(previousArtikel.id);
        }
    };

    /**
     * Navigate to next artikel
     */
    window.navigateToNextArtikel = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) return;
        
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        
        if (currentIndex < artikelListe.length - 1) {
            const nextArtikel = artikelListe[currentIndex + 1];
            openArtikelDetail(nextArtikel.id);
        }
    };

    /**
     * Update navigation buttons state
     */
    window.updateArtikelNavigation = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        
        if (!currentProjekt || !currentArtikelId) {
            console.warn('‚ö†Ô∏è No projekt or artikel selected');
            return;
        }
        
        // Try to get projekt
        const projekt = state.getProjekt(currentProjekt);
        if (!projekt) {
            console.error('‚ùå Projekt not found:', currentProjekt);
            return;
        }
        
        // Get artikel list
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) {
            console.error('‚ùå No artikel found for projekt:', currentProjekt);
            return;
        }
        
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        const artikel = artikelListe[currentIndex];
        
        if (!artikel) {
            console.error('‚ùå Current artikel not found in list:', currentArtikelId);
            return;
        }
        
        console.log('‚úÖ Found artikel:', artikel.name, `(${currentIndex + 1}/${artikelListe.length})`);
        
        // Update position display
        const positionEl = document.getElementById('artikel-position');
        const totalEl = document.getElementById('artikel-total');
        if (positionEl) positionEl.textContent = currentIndex + 1;
        if (totalEl) totalEl.textContent = artikelListe.length;
        
        // Update buttons
        const prevBtn = document.getElementById('prev-artikel-btn');
        const nextBtn = document.getElementById('next-artikel-btn');
        
        if (prevBtn) {
            prevBtn.disabled = currentIndex === 0;
            prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
        }
        
        if (nextBtn) {
            nextBtn.disabled = currentIndex === artikelListe.length - 1;
            nextBtn.style.opacity = currentIndex === artikelListe.length - 1 ? '0.5' : '1';
        }
        
        // Update breadcrumb
        const projektNameEl = document.getElementById('artikel-breadcrumb-projekt');
        const artikelNameEl = document.getElementById('artikel-breadcrumb-name');
        
        if (projektNameEl) projektNameEl.textContent = projekt.name;
        if (artikelNameEl) {
            artikelNameEl.textContent = artikel.name || 'Artikel bearbeiten';
            console.log('‚úÖ Breadcrumb updated to:', artikel.name);
        }
        
        // Update title
        const titleEl = document.getElementById('artikel-detail-title');
        if (titleEl) {
            titleEl.textContent = `‚úèÔ∏è ${artikel.name || 'Artikel bearbeiten'}`;
            console.log('‚úÖ Title updated to:', artikel.name);
        }
    };
    
// ==========================================
// ARTIKEL NAVIGATION (Vorheriger/N√§chster)
// ==========================================

/**
 * Navigate to previous artikel
 */
window.navigateToNextArtikel = function() {
    const currentProjekt = window.cfoDashboard.currentProjekt;
    const artikelListe = state.getArtikelByProjekt(currentProjekt);
    
    if (!artikelListe || artikelListe.length === 0) return;
    
    const currentArtikelId = window.cfoDashboard.currentArtikel;
    const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
    
    if (currentIndex < artikelListe.length - 1) {
        const nextArtikel = artikelListe[currentIndex + 1];
        openArtikelDetail(nextArtikel.id);
    }
};

/**
 * Navigate to next artikel
 */
window.navigateToNextArtikel = function() {
    const currentProjekt = window.cfoDashboard.currentProjekt;
    const projekt = state.getProjekt(currentProjekt);
    
    if (!projekt || !projekt.artikel || projekt.artikel.length === 0) return;
    
    const currentArtikelId = window.cfoDashboard.currentArtikel;
    const currentIndex = projekt.artikel.findIndex(a => a.id === currentArtikelId);
    
    if (currentIndex < projekt.artikel.length - 1) {
        const nextArtikel = projekt.artikel[currentIndex + 1];
        openArtikelDetail(nextArtikel.id);
    }
};

/**
 * Update navigation buttons state
 */
window.updateArtikelNavigation = function() {
    const currentProjekt = window.cfoDashboard.currentProjekt;
    const currentArtikelId = window.cfoDashboard.currentArtikel;
    
    if (!currentProjekt || !currentArtikelId) return;
    
    const projekt = state.getProjekt(currentProjekt);
    const artikelListe = state.getArtikelByProjekt(currentProjekt);
    
    if (!projekt || !artikelListe || artikelListe.length === 0) return;
    
    const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
    const artikel = artikelListe[currentIndex];
    
    if (!artikel) return;
    
    // Update position display
    const positionEl = document.getElementById('artikel-position');
    const totalEl = document.getElementById('artikel-total');
    if (positionEl) positionEl.textContent = currentIndex + 1;
    if (totalEl) totalEl.textContent = artikelListe.length;
    
    // Update buttons
    const prevBtn = document.getElementById('prev-artikel-btn');
    const nextBtn = document.getElementById('next-artikel-btn');
    
    if (prevBtn) {
        prevBtn.disabled = currentIndex === 0;
        prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
    }
    
    if (nextBtn) {
        nextBtn.disabled = currentIndex === artikelListe.length - 1;
        nextBtn.style.opacity = currentIndex === artikelListe.length - 1 ? '0.5' : '1';
    }
    
    // Update breadcrumb
    const projektNameEl = document.getElementById('artikel-breadcrumb-projekt');
    const artikelNameEl = document.getElementById('artikel-breadcrumb-name');
    
    if (projektNameEl) projektNameEl.textContent = projekt.name;
    if (artikelNameEl) artikelNameEl.textContent = artikel.name || 'Artikel bearbeiten';
    
    // Update title
    const titleEl = document.getElementById('artikel-detail-title');
    if (titleEl) titleEl.textContent = `‚úèÔ∏è ${artikel.name || 'Artikel bearbeiten'}`;
    
    console.log('‚úÖ Navigation updated:', artikel.name, `(${currentIndex + 1}/${artikelListe.length})`);
};
        
</script>

</body>
</html>
