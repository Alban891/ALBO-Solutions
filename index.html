<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALBO Solutions - Business Case Management Platform</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- ========================================== -->
    <!-- HEADER -->
    <!-- ========================================== -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>ALBO Solutions - Business Case Management</h1>
            <span class="header-subtitle">KI-gest√ºtzte Echtzeit-Analyse mit intelligenten Handlungsempfehlungen</span>
        </div>
        <!-- RECHTS: KPIs -->
        <div class="header-stats">
            <div class="stat">
                <div class="stat-value" id="npv-value">+44,7M‚Ç¨</div>
                <div class="stat-label">NPV (9 JAHRE)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="payback-value">3,4J</div>
                <div class="stat-label">PAYBACK</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="revenue-value">117,8M‚Ç¨</div>
                <div class="stat-label">TOTAL REVENUE</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="margin-value">34%</div>
                <div class="stat-label">√ò DB2-MARGE</div>
            </div>
        </div>
    </header>

    <!-- ========================================== -->
    <!-- MAIN NAVIGATION (Horvath-Style) -->
    <!-- ========================================== -->
    <nav class="main-navigation">
        <button class="tab-btn active" onclick="switchTab('cockpit')">
            üìä Cockpit
        </button>
        <button class="tab-btn" onclick="switchTab('projekte')">
            üíº Projekte
        </button>
        <button class="tab-btn" onclick="switchTab('performance')">
            üìà Performance
        </button>
        <button class="tab-btn" onclick="switchTab('admin')">
            ‚öôÔ∏è Admin
        </button>
    </nav>

    <!-- ========================================== -->
    <!-- MAIN CONTENT WRAPPER -->
    <!-- ========================================== -->
    <div class="main-content">
        <main class="dashboard-main">

            <!-- ========================================== -->
            <!-- TAB 1: COCKPIT (Portfolio Overview) -->
            <!-- ========================================== -->
            <div id="tab-cockpit" class="tab-content active">
    
    <!-- Welcome Header -->
    <div class="cockpit-welcome" style="
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        color: white;
        padding: 40px;
        border-radius: 12px;
        margin-bottom: 32px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    ">
        <h1 style="margin: 0 0 12px 0; font-size: 32px; font-weight: 700;">
            Herzlich Willkommen zur KI-gest√ºtzten Portfolio-Entscheidungsunterst√ºtzung
        </h1>
        <p style="margin: 0; font-size: 16px; opacity: 0.95; line-height: 1.6;">
            Strategisches Portfolio-Management mit BCG-Matrix und datengetriebenen Handlungsempfehlungen nach Horv√°th & Partners Methodik
        </p>
    </div>

    <!-- Portfolio KPIs -->
    <div class="portfolio-kpis" style="
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 32px;
    ">
        <!-- KPI Cards werden hier von cockpit.js eingef√ºgt -->
    </div>

    <!-- BCG Matrix -->
    <div class="bcg-matrix-container" style="
        background: white;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 32px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        position: relative;
        height: 600px;
    ">
        <canvas id="bcg-chart"></canvas>
    </div>

    <!-- Strategic Recommendations -->
    <div class="strategic-recommendations" style="
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    ">
        <!-- Recommendations werden hier von cockpit.js eingef√ºgt -->
    </div>

</div>

            <!-- ========================================== -->
            <!-- TAB 2: PROJEKTE -->
            <!-- ========================================== -->
            <div id="tab-projekte" class="tab-content">
                
                <!-- ========================================== -->
                <!-- VIEW: PROJEKT OVERVIEW (Default) -->
                <!-- ========================================== -->
                <div id="projekt-overview">
                    
                    <!-- Portfolio Overview Header (Horvath Style) -->
                    <div class="portfolio-overview-header">
                        <div class="portfolio-label">PORTFOLIO OVERVIEW</div>
                        <div class="portfolio-stats">
                            <div class="portfolio-stat">
                                <span class="portfolio-stat-value" id="stat-total-projects">0</span>
                                <span class="portfolio-stat-label">PROJEKTE</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-success">
                                <span class="portfolio-stat-value" id="stat-active-projects">0</span>
                                <span class="portfolio-stat-label">AKTIV</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-warning">
                                <span class="portfolio-stat-value" id="stat-onhold-projects">0</span>
                                <span class="portfolio-stat-label">ON HOLD</span>
                            </div>
                            <div class="portfolio-stat portfolio-stat-neutral">
                                <span class="portfolio-stat-value" id="stat-completed-projects">0</span>
                                <span class="portfolio-stat-label">ABGESCHLOSSEN</span>
                            </div>
                        </div>
                    </div>

                    <!-- Section Header with View Switcher -->
                    <div class="section-header-with-views">
                        <div class="section-title">
                            <span class="section-icon">üìÅ</span>
                            <h2>Projekt Portfolio</h2>
                        </div>
                        <div class="view-switcher">
                            <button class="view-btn active" data-view="liste" onclick="switchProjectView('liste')">
                                <span class="view-icon">‚ò∞</span> Liste
                            </button>
                            <button class="view-btn" data-view="karten" onclick="switchProjectView('karten')">
                                <span class="view-icon">‚ñ¶</span> Karten
                            </button>
                            <button class="view-btn" data-view="kompakt" onclick="switchProjectView('kompakt')">
                                <span class="view-icon">‚â°</span> Kompakt
                            </button>
                        </div>
                    </div>

                    <!-- Filter & Search -->
                    <div class="table-controls">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="projekt-search" 
                                   placeholder="Projekte durchsuchen..." 
                                   oninput="filterProjekte()">
                        </div>
                        
                        <div class="filter-group">
                            <label for="projekt-filter-status" class="sr-only">Status Filter</label>
                            <select id="projekt-filter-status" onchange="filterProjekte()" aria-label="Status Filter">
                                <option value="alle">Alle Status</option>
                                <option value="aktiv">Aktiv</option>
                                <option value="planung">Planung</option>
                                <option value="on-hold">On Hold</option>
                                <option value="abgeschlossen">Abgeschlossen</option>
                            </select>

                            <select id="projekt-sort" onchange="sortProjekte()">
                                <option value="name">Sortieren: Name</option>
                                <option value="start">Sortieren: Startdatum</option>
                                <option value="status">Sortieren: Status</option>
                                <option value="owner">Sortieren: Owner</option>
                            </select>
                        </div>
                    </div>

                    <!-- Projects Table -->
                    <div id="projekt-list-container">
                        <div class="table-container">
                            <!-- Loading Indicator -->
                            <div id="projekt-loading-indicator" class="loading-indicator">
                                <div class="spinner"></div>
                                <p>Projekte werden geladen...</p>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="40">
                                            <input type="checkbox" id="select-all-projects" 
                                                    onchange="toggleAllProjects(this)">
                                        </th>
                                        <th>PROJEKT</th>
                                        <th>DIVISION</th>
                                        <th>OWNER</th>
                                        <th width="100">START</th>
                                        <th width="100">END</th>
                                        <th width="100">STATUS</th>
                                        <th width="120">AKTIONEN</th>
                                    </tr>
                                </thead>
                                <tbody id="projekt-list-tbody">
                                    <!-- Projects will be rendered here by projekte.js -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Centered Create Button -->
                    <div class="centered-action">
                        <button class="btn btn-primary btn-large" onclick="openCreateProjektModal()">
                            ‚ûï Neues Projekt anlegen
                        </button>
                    </div>

                    <!-- Bulk Actions Bar -->
                    <div id="bulk-actions-bar" class="bulk-actions-bar">
                        <div class="bulk-actions-info">
                            <span id="bulk-count">0</span> Projekte ausgew√§hlt
                        </div>
                        <div class="bulk-actions-buttons">
                            <select id="bulk-status-change">
                                <option value="">Status √§ndern...</option>
                                <option value="Planung">‚Üí Planung</option>
                                <option value="Aktiv">‚Üí Aktiv</option>
                                <option value="On Hold">‚Üí On Hold</option>
                                <option value="Abgeschlossen">‚Üí Abgeschlossen</option>
                            </select>
                            <button class="btn btn-secondary" onclick="bulkStatusChange()">
                                Anwenden
                            </button>
                            <button class="btn btn-danger" onclick="bulkDeleteProjekte()">
                                üóëÔ∏è L√∂schen
                            </button>
                        </div>
                    </div>

                </div>
                <!-- Ende projekt-overview -->

                <!-- ========================================== -->
                <!-- VIEW: PROJEKT DETAIL (Hidden by default) -->
                <!-- ========================================== -->
                <div id="projekt-detail-view" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="projekt-detail-breadcrumb" class="breadcrumb-current">Projekt</span>
                    </div>

                    <!-- Header -->
                    <div class="section-header">
                        <h2 id="projekt-detail-title">Projekt</h2>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="backToProjektOverview()">
                                ‚Üê Zur√ºck
                            </button>
                        </div>
                    </div>

                    <!-- TAB-NAVIGATION INNERHALB PROJEKT -->
                    <div class="detail-tabs">
                        <button class="detail-tab" onclick="switchProjektTab('uebersicht')">
                            üìã √úbersicht
                        </button>
                        <button class="detail-tab active" onclick="switchProjektTab('artikel')">
                            üì¶ Artikel
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('projektkosten')">
                            üí∞ Projektkosten
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('wirtschaftlichkeit')">
                            üìà Wirtschaftlichkeit
                        </button>
                        <button class="detail-tab" onclick="switchProjektTab('dashboard')">
                            üìä Dashboard
                        </button>
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: √úBERSICHT -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-uebersicht" class="projekt-tab-content active">
                        <!-- Wird von uebersicht.js gef√ºllt -->
                    </div>
                            
                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: KOSTEN (Your existing design!) -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-projektkosten" class="projekt-tab-content">
                        
                        <div class="section-header">
                            <h3>üí∞ Projektkosten</h3>
                            <div class="header-actions">
                                <button class="btn btn-secondary" onclick="generateKostenEmpfehlungen()">
                                    ü§ñ KI-Empfehlungen
                                </button>
                                <button class="btn btn-primary" onclick="addKostenBlock()">
                                    ‚ûï Kostenblock
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px; padding: 16px; background: var(--bg-secondary); border-left: 4px solid var(--primary); border-radius: 4px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 24px;">‚ÑπÔ∏è</span>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Projektkosten-Verwaltung</div>
                                    <div style="font-size: 14px; color: var(--gray);">
                                        Diese Kosten gelten f√ºr <strong>alle Artikel</strong> in diesem Projekt.
                                        Nutzen Sie die KI-Empfehlungen f√ºr typische Kostenstrukturen.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cost Blocks Container (from kosten.js) -->
                        <div id="kosten-bloecke-container" class="kosten-bloecke">
                            <!-- Cost blocks will be added here dynamically by kosten.js -->
                        </div>

                        <!-- Total -->
                        <div class="kosten-total">
                            <div class="kosten-total-label">Gesamte Projektkosten:</div>
                            <div class="kosten-total-value" id="total-projektkosten">0‚Ç¨</div>
                        </div>

                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: ARTIKEL -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-artikel" class="projekt-tab-content">
                        
                        <!-- Header -->
                        <div class="section-header">
                            <div>
                                <h3>üì¶ Artikel</h3>
                                <p>Produktartikel und Services des Projekts</p>
                            </div>
                            <button class="btn btn-primary" onclick="createNewArtikel()">
                                ‚ûï Neuer Artikel
                            </button>
                        </div>

                        <!-- Articles Table -->
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="40">
                                            <input type="checkbox" id="select-all-artikel-projekt" 
                                                   onchange="toggleAllArtikelProjekt(this)">
                                        </th>
                                        <th>Artikelname</th>
                                        <th>Kategorie</th>
                                        <th>Release</th>
                                        <th>Umsatz</th>
                                        <th>DB2 %</th>
                                        <th>Status</th>
                                        <th width="150">Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="projekt-artikel-list-tbody">
                                    <!-- Articles will be rendered here by artikel.js -->
                                </tbody>
                            </table>
                        </div>

                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: DASHBOARD -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-dashboard" class="projekt-tab-content">
                        <div class="form-section">
                            <h3>üìä Projekt-Dashboard</h3>
                            <p style="color: var(--gray); margin-top: 8px;">
                                Hier werden alle Charts f√ºr dieses spezifische Projekt angezeigt (Coming Soon)
                            </p>
                            
                            <div class="insights-placeholder">
                                <div class="placeholder-icon">üìä</div>
                                <h4>Charts & Analysen</h4>
                                <p>Bald verf√ºgbar: Projekt-spezifische Dashboards mit allen relevanten Kennzahlen und Diagrammen.</p>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: WIRTSCHAFTLICHKEIT -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-wirtschaftlichkeit" class="projekt-tab-content">
                        <!-- Wird von wirtschaftlichkeit.js gef√ºllt -->
                    </div>

                    <!-- ========================================== -->
                    <!-- PROJEKT TAB: BUSINESS CASE -->
                    <!-- ========================================== -->
                    <div id="projekt-tab-business-case" class="projekt-tab-content">
                        <div class="form-section">
                            <h3>ü§ñ Business Case Empfehlung</h3>
                            <p style="color: var(--gray); margin-top: 8px;">
                                KI-basierte Analyse und Empfehlung (Coming Soon)
                            </p>
                            
                            <div class="insights-placeholder">
                                <div class="placeholder-icon">ü§ñ</div>
                                <h4>KI-Analyse</h4>
                                <p>Bald verf√ºgbar: Automatische Business Case Bewertung, Risiko-Analyse, Benchmark-Vergleich und Go/No-Go Empfehlung.</p>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- Ende projekt-detail-view -->

                <!-- ========================================== -->
                <!-- VIEW: ARTIKEL OVERVIEW (When projekt selected) -->
                <!-- ========================================== -->
                <div id="artikel-overview" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="current-projekt-name" class="breadcrumb-current">Projekt</span>
                    </div>

                    <!-- Header -->
                    <div class="section-header">
                        <div>
                            <h2>üì¶ Artikel</h2>
                            <p>Produktartikel und Services des Projekts</p>
                        </div>
                        <button class="btn btn-primary" onclick="createNewArtikel()">
                            ‚ûï Neuer Artikel
                        </button>
                    </div>

                    <!-- Articles Table -->
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" id="select-all-artikel" 
                                               onchange="toggleAllArtikel(this)">
                                    </th>
                                    <th>Artikelname</th>
                                    <th>Kategorie</th>
                                    <th>Release</th>
                                    <th>Umsatz</th>
                                    <th>DB2 %</th>
                                    <th>Status</th>
                                    <th width="150">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="artikel-list-tbody">
                                <!-- Articles will be rendered here by artikel.js -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Bulk Actions -->
                    <div id="artikel-bulk-actions-bar" class="bulk-actions-bar">
                        <div class="bulk-actions-info">
                            <span id="artikel-bulk-count">0</span> Artikel ausgew√§hlt
                        </div>
                        <div class="bulk-actions-buttons">
                            <button class="btn btn-danger" onclick="bulkDeleteArtikel()">
                                üóëÔ∏è L√∂schen
                            </button>
                        </div>
                    </div>

                </div>
                <!-- Ende artikel-overview -->

                <!-- ========================================== -->
                <!-- VIEW: ARTIKEL DETAIL (Hidden by default) -->
                <!-- ========================================== -->
                <div id="artikel-detail-view" style="display: none;">
                    
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <button class="breadcrumb-link" onclick="backToProjektOverview()">
                            üíº Projekte
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="artikel-breadcrumb-projekt" class="breadcrumb-current">Projekt</span>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <button class="breadcrumb-link" onclick="closeArtikelDetail()">
                            üì¶ Artikel
                        </button>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span id="artikel-breadcrumb-name" class="breadcrumb-current">Artikel bearbeiten</span>
                    </div>

                    <div id="artikel-update-info" style="
                        display: none;
                        padding: 10px 16px;
                        background: rgba(16, 185, 129, 0.1);
                        border-left: 3px solid var(--success);
                        border-radius: 4px;
                        margin-bottom: 16px;
                        font-size: 13px;
                        color: var(--text);
                    ">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>

                    <!-- Header mit Navigation -->
                    <div class="section-header" style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <button class="btn btn-secondary" onclick="closeArtikelDetail()" 
                                    style="display: flex; align-items: center; gap: 8px;">
                                ‚Üê Zur√ºck zur Artikel-√úbersicht
                            </button>

                            <div style="display: flex; align-items: center; gap: 12px; margin-left: auto;">
                                <button class="btn btn-secondary btn-sm" onclick="navigateToPreviousArtikel()" 
                                        id="prev-artikel-btn" style="display: flex; align-items: center; gap: 4px;">
                                    ‚óÄ Vorheriger
                                </button>
                    
                                <div style="padding: 8px 16px; background: var(--bg-secondary); border-radius: 6px; font-size: 14px; font-weight: 500;">
                                    Artikel <span id="artikel-position">1</span> von <span id="artikel-total">3</span>
                                </div>
                    
                                <button class="btn btn-secondary btn-sm" onclick="navigateToNextArtikel()" 
                                        id="next-artikel-btn" style="display: flex; align-items: center; gap: 4px;">
                                    N√§chster ‚ñ∂
                                </button>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; margin-top: 16px;">
                            <h2 id="artikel-detail-title" style="margin: 0; flex: 1;">‚úèÔ∏è Artikel bearbeiten</h2>
                            <button class="btn btn-secondary" onclick="closeArtikelDetail()">
                                Abbrechen
                            </button>
                            <button class="btn btn-primary" onclick="saveArtikelChanges()">
                                üíæ Speichern
                            </button>
                        </div>
                    </div>

                    <!-- ========================================== -->
                    <!-- ALLE INHALTE AUF EINER SEITE (KEINE TABS!) -->
                    <!-- ========================================== -->
                    
                    <!-- Basis-Informationen & Markt -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                        
                        <!-- LINKE SPALTE: Basis-Informationen -->
                        <div class="form-section">
                            <h3>üìù Basis-Informationen</h3>
                            
                            <div class="form-group">
                                <label>Artikelname *</label>
                                <input type="text" id="artikel-name" 
                                    placeholder="z.B. Smart Sensor X1" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Typ *</label>
                                    <select id="artikel-typ">
                                        <option value="">Bitte w√§hlen...</option>
                                        <option value="Hardware">Hardware</option>
                                        <option value="Software">Software</option>
                                        <option value="Service">Service</option>
                                        <option value="Hybrid">Hybrid</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Kategorie</label>
                                    <input type="text" id="kategorie" 
                                        placeholder="z.B. IoT Sensor">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Beschreibung</label>
                                <textarea id="artikel-beschreibung" rows="3" 
                                        placeholder="Kurze Produktbeschreibung..."></textarea>
                            </div>
                        </div>

                        <!-- RECHTE SPALTE: Markt & Strategie -->
                        <div class="form-section">
                            <h3>üéØ Markt & Strategie</h3>

                            <div class="form-group">
                                <label>Gesch√§ftsmodell</label>
                                <select id="geschaeftsmodell">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="einmalverkauf">Einmalverkauf</option>
                                    <option value="subscription">Subscription</option>
                                    <option value="freemium">Freemium</option>
                                    <option value="lizenz">Lizenzmodell</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Zielmarkt</label>
                                <input type="text" id="zielmarkt" 
                                    placeholder="z.B. DACH Region, B2B">
                            </div>

                            <div class="form-group">
                                <label>Strategie</label>
                                <select id="strategie">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="innovator">Innovator/First Mover</option>
                                    <option value="fast-follower">Fast Follower</option>
                                    <option value="cost-leader">Cost Leader</option>
                                    <option value="niche">Nische/Spezialist</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Investment-Typ</label>
                                <select id="investment-typ">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="growth">Growth</option>
                                    <option value="efficiency">Efficiency</option>
                                    <option value="innovation">Innovation</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ========================================== -->
                    <!-- FINANZ-PARAMETER & ENTWICKLUNGSMODELLE -->
                    <!-- ========================================== -->
                    <div class="form-section" style="margin-bottom: 24px;">
                        <h3>üí∞ Finanz-Parameter & Entwicklungsmodelle</h3>
                        
                        <!-- Planungshorizont -->
                        <div style="background: white; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px; align-items: center;">
                                <div>
                                    <label style="font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; display: block; margin-bottom: 6px;">
                                        üìÖ Release / Startdatum
                                    </label>
                                    <input type="month" id="release-datum" 
                                        onchange="updateZeithorizont(); updateTabellenSpalten(); berechneModelle();"
                                        style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px; font-size: 13px;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; display: block; margin-bottom: 6px;">
                                        Zeithorizont
                                    </label>
                                    <div class="zeitraum-selector" style="display: flex; gap: 8px;">
                                        <button type="button" onclick="setzeZeitraum(3)" class="zeitraum-btn" id="zeitraum-btn-3"
                                                style="flex: 1; padding: 10px 20px; border: 1px solid #e5e7eb; background: white; 
                                                    border-radius: 6px; font-size: 13px; cursor: pointer; transition: all 0.2s;
                                                    font-weight: 500; color: #374151;">
                                            3 Jahre
                                        </button>
                                        <button type="button" onclick="setzeZeitraum(5)" class="zeitraum-btn active" id="zeitraum-btn-5"
                                                style="flex: 1; padding: 10px 20px; border: 2px solid #1e3a8a; background: #1e3a8a; 
                                                    color: white; border-radius: 6px; font-size: 13px; cursor: pointer; 
                                                    font-weight: 600;">
                                            5 Jahre
                                        </button>
                                        <button type="button" onclick="setzeZeitraum(7)" class="zeitraum-btn" id="zeitraum-btn-7"
                                                style="flex: 1; padding: 10px 20px; border: 1px solid #e5e7eb; background: white; 
                                                    border-radius: 6px; font-size: 13px; cursor: pointer; transition: all 0.2s;
                                                    font-weight: 500; color: #374151;">
                                            7 Jahre
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Startwerte (Jahr 1) -->
                        <div style="background: white; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                            <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 12px;">
                                üìä Startwerte (Jahr 1)
                            </div>

                            <!-- Hinweis-Box -->
                            <div style="background: #fef3c7; border-left: 3px solid #f59e0b; padding: 10px; margin-bottom: 12px; border-radius: 4px; font-size: 11px;">
                                <strong>üí° Tipp:</strong> Tragen Sie hier Ihre Annahmen f√ºr das erste Jahr ein. Diese Werte dienen als Basis f√ºr die automatischen Entwicklungsmodelle.
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                <div>
                                    <label style="font-size: 10px; color: #6b7280; display: block; margin-bottom: 4px; text-transform: uppercase;">
                                        MENGE (ST√úCK)
                                    </label>
                                    <input type="text" id="start-menge" 
                                        placeholder="z.B. 1.000"
                                        onfocus="handleInputFocus(this)"
                                        onblur="handleInputBlur(this, 'menge')"
                                        onchange="updateErsteZeile();"
                                        oninput="updateErsteZeile();"
                                        style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 4px; 
                                                font-size: 14px; text-align: center; font-weight: 600; background: white;
                                                color: #6b7280;">
                                </div>
                                <div>
                                    <label style="font-size: 10px; color: #6b7280; display: block; margin-bottom: 4px; text-transform: uppercase;">
                                        PREIS (‚Ç¨/ST√úCK)
                                    </label>
                                    <input type="text" id="start-preis"
                                        placeholder="z.B. 50,00"
                                        onfocus="handleInputFocus(this)"
                                        onblur="handleInputBlur(this, 'preis')"
                                        onchange="updateErsteZeile();"
                                        oninput="updateErsteZeile();"
                                        style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 4px; 
                                                font-size: 14px; text-align: center; font-weight: 600; background: white;
                                                color: #6b7280;">
                                </div>
                                <div>
                                    <label style="font-size: 10px; color: #6b7280; display: block; margin-bottom: 4px; text-transform: uppercase;">
                                        HK (‚Ç¨/ST√úCK)
                                    </label>
                                    <input type="text" id="start-hk"
                                        placeholder="z.B. 20,00"
                                        onfocus="handleInputFocus(this)"
                                        onblur="handleInputBlur(this, 'hk')"
                                        onchange="updateErsteZeile();"
                                        oninput="updateErsteZeile();"
                                        style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 4px; 
                                                font-size: 14px; text-align: center; font-weight: 600; background: white;
                                                color: #6b7280;">
                                </div>
                            </div>
                        </div>

                        <!-- Entwicklungsmodelle -->
                        <div style="margin-bottom: 16px;">
                            <div style="border-top: 2px solid #e5e7eb; margin: 20px 0; position: relative;">
                                <span style="position: absolute; top: -10px; left: 20px; background: white; padding: 0 10px; font-size: 11px; font-weight: 600; color: #6b7280;">
                                    üìà ENTWICKLUNGSMODELLE
                                </span>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                <!-- Mengenentwicklung -->
                                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px;">
                                    <div style="font-size: 11px; font-weight: 600; color: #374151; margin-bottom: 12px; text-transform: uppercase;">
                                        Mengenentwicklung
                                    </div>
                                    <div style="font-size: 11px;">
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="mengen-modell" value="konservativ" onchange="applyModell('menge', 'konservativ')">
                                            <span style="margin-left: 6px;">Konservativ <span style="color: #6b7280;">(+15% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="mengen-modell" value="realistisch" checked onchange="applyModell('menge', 'realistisch')">
                                            <span style="margin-left: 6px; font-weight: 600;">Realistisch <span style="color: #6b7280; font-weight: normal;">(S-Kurve)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="mengen-modell" value="optimistisch" onchange="applyModell('menge', 'optimistisch')">
                                            <span style="margin-left: 6px;">Optimistisch <span style="color: #6b7280;">(Hockey-Stick)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="mengen-modell" value="manuell" onchange="applyModell('menge', 'manuell')">
                                            <span style="margin-left: 6px; color: #6b7280;">Manuell</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Preisentwicklung -->
                                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px;">
                                    <div style="font-size: 11px; font-weight: 600; color: #374151; margin-bottom: 12px; text-transform: uppercase;">
                                        Preisentwicklung
                                    </div>
                                    <div style="font-size: 11px;">
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="preis-modell" value="konstant" checked onchange="applyModell('preis', 'konstant')">
                                            <span style="margin-left: 6px; font-weight: 600;">Konstant <span style="color: #6b7280; font-weight: normal;">(0% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="preis-modell" value="inflation" onchange="applyModell('preis', 'inflation')">
                                            <span style="margin-left: 6px;">Inflation <span style="color: #6b7280;">(+2% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="preis-modell" value="premium" onchange="applyModell('preis', 'premium')">
                                            <span style="margin-left: 6px;">Premium <span style="color: #6b7280;">(+5% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="preis-modell" value="skimming" onchange="applyModell('preis', 'skimming')">
                                            <span style="margin-left: 6px;">Skimming <span style="color: #6b7280;">(-3% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="preis-modell" value="manuell" onchange="applyModell('preis', 'manuell')">
                                            <span style="margin-left: 6px; color: #6b7280;">Manuell</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Kostenentwicklung -->
                                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px;">
                                    <div style="font-size: 11px; font-weight: 600; color: #374151; margin-bottom: 12px; text-transform: uppercase;">
                                        Kostenentwicklung
                                    </div>
                                    <div style="font-size: 11px;">
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="kosten-modell" value="konstant" onchange="applyModell('kosten', 'konstant')">
                                            <span style="margin-left: 6px;">Konstant <span style="color: #6b7280;">(0% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="kosten-modell" value="lernkurve" checked onchange="applyModell('kosten', 'lernkurve')">
                                            <span style="margin-left: 6px; font-weight: 600;">Lernkurve <span style="color: #6b7280; font-weight: normal;">(-5% bei 2x)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="kosten-modell" value="inflation" onchange="applyModell('kosten', 'inflation')">
                                            <span style="margin-left: 6px;">Inflation <span style="color: #6b7280;">(+3% p.a.)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="kosten-modell" value="skaleneffekte" onchange="applyModell('kosten', 'skaleneffekte')">
                                            <span style="margin-left: 6px;">Skaleneffekte <span style="color: #6b7280;">(Stufen)</span></span>
                                        </label>
                                        <label style="display: block; padding: 6px 0; cursor: pointer;">
                                            <input type="radio" name="kosten-modell" value="manuell" onchange="applyModell('kosten', 'manuell')">
                                            <span style="margin-left: 6px; color: #6b7280;">Manuell</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 16px;">
                                <button onclick="berechneModelle();" 
                                        style="padding: 10px 30px; background: #1e3a8a; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                                    Berechnen & Vorschau aktualisieren
                                </button>
                                <button onclick="resetModelle()" 
                                        style="padding: 10px 30px; background: white; color: #6b7280; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; cursor: pointer; margin-left: 12px;">
                                    Zur√ºcksetzen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Ergebnis-Vorschau Tabelle -->
                        <div style="background: white; border-radius: 6px; overflow-x: auto;">
                            <div style="padding: 12px; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                                <div style="font-size: 12px; font-weight: 600; color: #374151;">üìä ERGEBNIS-VORSCHAU</div>
                            </div>
                            <table id="vorschau-tabelle" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                <thead>
                                    <tr style="background: #f8fafc;">
                                        <th style="padding: 10px; text-align: left; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 120px;">Parameter</th>
                                        <th class="jahr-col jahr-1" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 100px;">
                                            <span class="jahr-header-1">2025</span>
                                        </th>
                                        <th class="jahr-col jahr-2" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 100px;">
                                            <span class="jahr-header-2">2026</span>
                                        </th>
                                        <th class="jahr-col jahr-3" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 100px;">
                                            <span class="jahr-header-3">2027</span>
                                        </th>
                                        <th class="jahr-col jahr-4" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 100px;">
                                            <span class="jahr-header-4">2028</span>
                                        </th>
                                        <th class="jahr-col jahr-5" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; width: 100px;">
                                            <span class="jahr-header-5">2029</span>
                                        </th>
                                        <th class="jahr-col jahr-6" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; display: none; width: 100px;">
                                            <span class="jahr-header-6">2030</span>
                                        </th>
                                        <th class="jahr-col jahr-7" style="padding: 10px; text-align: center; font-weight: 600; border-bottom: 2px solid #e5e7eb; display: none; width: 100px;">
                                            <span class="jahr-header-7">2031</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 10px; font-weight: 600; background: #f8fafc;">Menge (St√ºck)</td>
                                        <td class="jahr-col jahr-1" style="padding: 10px; text-align: center;">
                                            <input type="text" id="menge-jahr-1" 
                                                onchange="formatNumberInput(this)" 
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-2" style="padding: 10px; text-align: center;">
                                            <input type="text" id="menge-jahr-2" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-3" style="padding: 10px; text-align: center;">
                                            <input type="text" id="menge-jahr-3" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-4" style="padding: 10px; text-align: center;">
                                            <input type="text" id="menge-jahr-4" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-5" style="padding: 10px; text-align: center;">
                                            <input type="text" id="menge-jahr-5" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-6" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="menge-jahr-6" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-7" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="menge-jahr-7" 
                                                onchange="formatNumberInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr style="background: #f8fafc;">
                                        <td style="padding: 10px; font-weight: 600;">Preis (‚Ç¨/St√ºck)</td>
                                        <td class="jahr-col jahr-1" style="padding: 10px; text-align: center;">
                                            <input type="text" id="preis-jahr-1" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-2" style="padding: 10px; text-align: center;">
                                            <input type="text" id="preis-jahr-2" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-3" style="padding: 10px; text-align: center;">
                                            <input type="text" id="preis-jahr-3" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-4" style="padding: 10px; text-align: center;">
                                            <input type="text" id="preis-jahr-4" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-5" style="padding: 10px; text-align: center;">
                                            <input type="text" id="preis-jahr-5" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-6" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="preis-jahr-6" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-7" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="preis-jahr-7" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; font-weight: 600; background: #f8fafc;">HK (‚Ç¨/St√ºck)</td>
                                        <td class="jahr-col jahr-1" style="padding: 10px; text-align: center;">
                                            <input type="text" id="hk-jahr-1" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-2" style="padding: 10px; text-align: center;">
                                            <input type="text" id="hk-jahr-2" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-3" style="padding: 10px; text-align: center;">
                                            <input type="text" id="hk-jahr-3" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-4" style="padding: 10px; text-align: center;">
                                            <input type="text" id="hk-jahr-4" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-5" style="padding: 10px; text-align: center;">
                                            <input type="text" id="hk-jahr-5" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-6" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="hk-jahr-6" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                        <td class="jahr-col jahr-7" style="padding: 10px; text-align: center; display: none;">
                                            <input type="text" id="hk-jahr-7" 
                                                onchange="formatDecimalInput(this)"
                                                style="width: 70px; padding: 4px; border: 1px solid #e5e7eb; border-radius: 3px; text-align: center;">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                   
                <!-- Ende artikel-detail-view -->

            </div>
            <!-- Ende tab-projekte -->

            <!-- ========================================== -->
            <!-- TAB 3: PERFORMANCE -->
            <!-- ========================================== -->
            <div id="tab-performance" class="tab-content">
                
                <div class="insights-container">
                    <h2>üìà Performance Controlling</h2>
                    <p>Plan-Ist-Forecast √ºber alle Projekte (Coming Soon)</p>
                    
                    <div class="insights-placeholder">
                        <div class="placeholder-icon">üìä</div>
                        <h3>In Entwicklung</h3>
                        <p>Hier werden bald Plan-Ist-Vergleiche, Rolling Forecasts und Performance-Analysen verf√ºgbar sein.</p>
                    </div>
                </div>

            </div>

            <!-- ========================================== -->
            <!-- TAB 4: ADMIN -->
            <!-- ========================================== -->
            <div id="tab-admin" class="tab-content">
                
                <div class="insights-container">
                    <h2>‚öôÔ∏è Administration</h2>
                    <p>Einstellungen und Stammdaten (Coming Soon)</p>
                    
                    <div class="insights-placeholder">
                        <div class="placeholder-icon">üîß</div>
                        <h3>In Entwicklung</h3>
                        <p>Hier werden bald Einstellungen, Stammdaten-Verwaltung und System-Konfigurationen verf√ºgbar sein.</p>
                    </div>
                </div>

            </div>

        </main>

        <!-- ========================================== -->
        <!-- ALBO AI SIDEBAR - CLEAN FEED VERSION -->
        <!-- ========================================== -->
        <div class="sidebar" id="albo-sidebar">
            
            <!-- Header -->
            <div class="ai-header">
                <div class="ai-status">
                    <div class="ai-status-indicator"></div>
                    <div>
                        <div style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">
                            ü§ñ ALBO Senior Controller
                        </div>
                        <div style="font-size: 11px; opacity: 0.9;">
                            Live Business Case Monitoring
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitor Feed (direkt ohne Tabs) -->
            <div class="albo-monitor-feed" style="
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                padding: 0;
            ">
                <div class="albo-chat-messages" id="albo-chat-messages" style="
                    flex: 1;
                    overflow-y: auto;
                    padding: 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                ">
                    <!-- Feed messages will be added here by ALBO -->
                </div>
                
                <!-- Input am Ende -->
                <div class="albo-chat-input-wrapper" style="
                    padding: 16px;
                    border-top: 1px solid rgba(255,255,255,0.1);
                    background: rgba(255,255,255,0.05);
                    position: relative;
                ">
                    <input type="text" 
                        class="albo-chat-input" 
                        id="albo-chat-input"
                        placeholder="Frage ALBO etwas..."
                        onkeypress="if(event.key==='Enter') sendAlboMessage()"
                        style="
                            width: 100%;
                            padding: 12px 50px 12px 12px;
                            border: 1px solid rgba(255,255,255,0.2);
                            border-radius: 6px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            font-size: 14px;
                            outline: none;
                        ">
                    <button class="albo-chat-send" 
                            onclick="sendAlboMessage()"
                            style="
                                position: absolute;
                                right: 24px;
                                top: 50%;
                                transform: translateY(-50%);
                                background: rgba(255,255,255,0.2);
                                border: none;
                                color: white;
                                width: 36px;
                                height: 36px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-size: 18px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s;
                            "
                            onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                            onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        ‚Üí
                    </button>
                </div>
            </div>

        </div>

    </div> <!-- Ende main-content -->

    <!-- ========================================== -->
    <!-- SCRIPTS -->
    <!-- ========================================== -->
    
    <!-- Load Modules (ES6) -->
    <script type="module">
    // Import all modules
    import './js/main.js';
    import { state } from './js/state.js';
    import * as helpers from './js/helpers.js';
    import { renderProjektOverview, updateProjektStats } from './js/modules/projekte.js';
    import { renderArtikelListByProjekt } from './js/modules/artikel.js';
    
    // Make modules globally available for inline handlers
    window.state = state;
    window.helpers = helpers;
    window.renderProjektOverview = renderProjektOverview;
    window.updateProjektStats = updateProjektStats;
    window.renderArtikelListByProjekt = renderArtikelListByProjekt;

    // NEW: Projekt-Tab switching function
    window.switchProjektTab = function(tabName) {
        console.log('üìë Switching projekt tab:', tabName);

        // Update tab buttons
        document.querySelectorAll('.detail-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Update tab contents
        document.querySelectorAll('.projekt-tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // üÜï ALBO Event: Tab gewechselt
        document.dispatchEvent(new CustomEvent('tab-changed', {
            detail: {
                tab: tabName,
                projekt: window.cfoDashboard.currentProjekt,
                artikel: window.cfoDashboard.currentArtikel
            }
        }));

        // Activate target tab
        const targetButton = document.querySelector(`[onclick="switchProjektTab('${tabName}')"]`);
        const targetContent = document.getElementById(`projekt-tab-${tabName}`);

        if (targetButton) targetButton.classList.add('active');
        if (targetContent) targetContent.classList.add('active');

        // ‚úì‚úì‚úì CRITICAL: Save navigation state ‚úì‚úì‚úì
        if (window.state) {
            window.state.currentProjektTab = tabName;
            window.state.projektViewMode = 'detail';
            window.state.saveState();
            console.log('üíæ Saved projekt tab to state:', tabName);
        } else {
            console.error('‚ùå window.state not available!');
        }

        // Special handling for different tabs
        if (tabName === 'artikel') {
            // Render artikel list for this projekt
            const projektId = window.cfoDashboard.currentProjekt;
            if (projektId) {
                const tbody = document.getElementById('projekt-artikel-list-tbody');
                if (tbody && window.renderArtikelListByProjekt) {
                    window.renderArtikelListByProjekt();
                    const sourceBody = document.getElementById('artikel-list-tbody');
                    if (sourceBody) {
                        tbody.innerHTML = sourceBody.innerHTML;
                    }
                }
            }
            
            // Set artikel view mode to list
            if (window.state) {
                window.state.artikelViewMode = 'list';
                window.state.currentArtikel = null;
                window.state.saveState();
            }
        }  // ‚úÖ DIESE KLAMMER FEHLTE!
        else if (tabName === 'uebersicht') {
            // Import und render √úbersicht (Executive Summary)
            import('./js/modules/uebersicht.js').then(module => {
                if (module.renderUebersicht) {
                    module.renderUebersicht();
                }
            }).catch(err => {
                console.error('Failed to load uebersicht module:', err);
            });        
        }
        else if (tabName === 'projektkosten') {
            // Import und render Projektkosten
            import('./js/modules/projektkosten.js').then(module => {
                if (module.renderProjektkosten) {
                    module.renderProjektkosten();
                }
            }).catch(err => {
                console.error('Failed to load projektkosten module:', err);
            });
        }
        else if (tabName === 'wirtschaftlichkeit') {
            // Import und render Wirtschaftlichkeit
            import('./js/modules/wirtschaftlichkeit/wirtschaftlichkeit.js').then(module => {
                if (module.renderProjektWirtschaftlichkeit) {
                    module.renderProjektWirtschaftlichkeit();
                }
            }).catch(err => {
                console.error('Failed to load wirtschaftlichkeit module:', err);
            });
        }
        else if (tabName === 'dashboard') {
            // Import und render Dashboard
            import('./js/modules/dashboard/dashboard.js').then(module => {
                if (module.renderProjektDashboard) {
                    module.renderProjektDashboard();
                }
            }).catch(err => {
                console.error('Failed to load dashboard module:', err);
            });
        }
    };

    // Navigate to projekt wirtschaftlichkeit from artikel
    window.navigateToProjektWirtschaftlichkeit = function() {
        const projektId = window.cfoDashboard.currentProjekt;
        if (!projektId) return;

        // Close artikel detail if open
        const artikelDetail = document.getElementById('artikel-detail-view');
        if (artikelDetail) artikelDetail.style.display = 'none';

        // Hide other views
        const projektOverview = document.getElementById('projekt-overview');
        const artikelOverview = document.getElementById('artikel-overview');
        
        if (projektOverview) projektOverview.style.display = 'none';
        if (artikelOverview) artikelOverview.style.display = 'none';

        // Show projekt detail
        const projektDetail = document.getElementById('projekt-detail-view');
        if (projektDetail) projektDetail.style.display = 'block';

        // Switch to wirtschaftlichkeit tab
        window.switchProjektTab('wirtschaftlichkeit');
    };

    // Open projekt detail view
    window.openProjektDetail = function(projektId) {
        const projekt = window.cfoDashboard.projektData[projektId] || state.getProjekt(projektId);
        if (!projekt) {
            console.error('Projekt not found:', projektId);
            return;
        }

        console.log('üìÇ Opening projekt detail:', projekt.name);

        // Set current projekt
        window.cfoDashboard.currentProjekt = projektId;
        
        // ‚úì‚úì‚úì CRITICAL: Save complete navigation state ‚úì‚úì‚úì
        if (window.state) {
            window.state.currentProjekt = projektId;
            window.state.projektViewMode = 'detail';
            window.state.currentProjektTab = 'uebersicht'; // Default tab
            window.state.currentArtikel = null;  // Clear artikel selection
            window.state.artikelViewMode = 'list';
            window.state.saveState();
            console.log('üíæ Saved projekt detail state');
        }

        // Hide projekt overview
        const projektOverview = document.getElementById('projekt-overview');
        if (projektOverview) projektOverview.style.display = 'none';

        // Show projekt detail
        const projektDetail = document.getElementById('projekt-detail-view');
        if (projektDetail) projektDetail.style.display = 'block';

        // Update breadcrumb & title
        const breadcrumb = document.getElementById('projekt-detail-breadcrumb');
        const title = document.getElementById('projekt-detail-title');
        if (breadcrumb) breadcrumb.textContent = projekt.name;
        if (title) title.textContent = projekt.name;

        // NEU: Lade Projekt-Daten in √úbersicht
        const ownerEl = document.getElementById('projekt-detail-owner');
        const statusEl = document.getElementById('projekt-detail-status');
        const divisionEl = document.getElementById('projekt-detail-division');
        const zeitraumEl = document.getElementById('projekt-detail-zeitraum');

        if (ownerEl) ownerEl.textContent = projekt.owner || '-';
        if (statusEl) statusEl.textContent = projekt.status || 'Aktiv';
        if (divisionEl) divisionEl.textContent = projekt.division || '-';
        if (zeitraumEl) {
            const start = projekt.startDatum || '-';
            const end = projekt.endDatum || '-';
            zeitraumEl.textContent = `${start} - ${end}`;
        }

        // Switch to first tab
        switchProjektTab('uebersicht');
    };

    // ==========================================
    // ARTIKEL NAVIGATION (Vorheriger/N√§chster)
    // ==========================================

    /**
     * Navigate to previous artikel
     */
    window.navigateToPreviousArtikel = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) return;
        
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        
        if (currentIndex > 0) {
            const previousArtikel = artikelListe[currentIndex - 1];
            if (window.openArtikelDetail) {
                window.openArtikelDetail(previousArtikel.id);
            }
        }
    };

    /**
     * Navigate to next artikel
     */
    window.navigateToNextArtikel = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) return;
        
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        
        if (currentIndex < artikelListe.length - 1) {
            const nextArtikel = artikelListe[currentIndex + 1];
            if (window.openArtikelDetail) {
                window.openArtikelDetail(nextArtikel.id);
            }
        }
    };

    /**
     * Update navigation buttons state
     */
    window.updateArtikelNavigation = function() {
        const currentProjekt = window.cfoDashboard.currentProjekt;
        const currentArtikelId = window.cfoDashboard.currentArtikel;
        
        if (!currentProjekt || !currentArtikelId) {
            console.warn('‚ö†Ô∏è No projekt or artikel selected');
            return;
        }
        
        // Try to get projekt
        const projekt = state.getProjekt(currentProjekt);
        if (!projekt) {
            console.error('‚ùå Projekt not found:', currentProjekt);
            return;
        }
        
        // Get artikel list
        const artikelListe = state.getArtikelByProjekt(currentProjekt);
        
        if (!artikelListe || artikelListe.length === 0) {
            console.error('‚ùå No artikel found for projekt:', currentProjekt);
            return;
        }
        
        const currentIndex = artikelListe.findIndex(a => a.id === currentArtikelId);
        const artikel = artikelListe[currentIndex];
        
        if (!artikel) {
            console.error('‚ùå Current artikel not found in list:', currentArtikelId);
            return;
        }
        
        console.log('‚úÖ Found artikel:', artikel.name, `(${currentIndex + 1}/${artikelListe.length})`);
        
        // Update position display
        const positionEl = document.getElementById('artikel-position');
        const totalEl = document.getElementById('artikel-total');
        if (positionEl) positionEl.textContent = currentIndex + 1;
        if (totalEl) totalEl.textContent = artikelListe.length;
        
        // Update buttons
        const prevBtn = document.getElementById('prev-artikel-btn');
        const nextBtn = document.getElementById('next-artikel-btn');
        
        if (prevBtn) {
            prevBtn.disabled = currentIndex === 0;
            prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
        }
        
        if (nextBtn) {
            nextBtn.disabled = currentIndex === artikelListe.length - 1;
            nextBtn.style.opacity = currentIndex === artikelListe.length - 1 ? '0.5' : '1';
        }
        
        // Update breadcrumb
        const projektNameEl = document.getElementById('artikel-breadcrumb-projekt');
        const artikelNameEl = document.getElementById('artikel-breadcrumb-name');
        
        if (projektNameEl) projektNameEl.textContent = projekt.name;
        if (artikelNameEl) {
            artikelNameEl.textContent = artikel.name || 'Artikel bearbeiten';
            console.log('‚úÖ Breadcrumb updated to:', artikel.name);
        }
        
        // Update title
        const titleEl = document.getElementById('artikel-detail-title');
        if (titleEl) {
            titleEl.textContent = `‚úèÔ∏è ${artikel.name || 'Artikel bearbeiten'}`;
            console.log('‚úÖ Title updated to:', artikel.name);
        }
    };

    console.log('‚úÖ All modules and navigation functions loaded');

    </script>

    <!-- ========================================== -->
    <!-- ALBO SIDEBAR TAB SWITCHING -->
    <!-- ========================================== -->
    <script>
    // ALBO Sidebar Tab Switching
    window.switchAlboTab = function(tabName) {
      console.log('üîÑ Switching to tab:', tabName);
      
      // Update tabs
      document.querySelectorAll('.albo-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      const activeTab = document.querySelector(`[onclick="switchAlboTab('${tabName}')"]`);
      if (activeTab) {
        activeTab.classList.add('active');
      }
      
      // Update content
      document.querySelectorAll('.albo-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const activeContent = document.getElementById(`albo-tab-${tabName}`);
      if (activeContent) {
        activeContent.classList.add('active');
      }
    };

    // Run ALBO Analysis
    window.runAlboAnalysis = function() {
      console.log('ü§ñ Running ALBO Analysis...');
      
      // Get context
      const context = window.ALBOContext ? window.ALBOContext.getCurrentContext() : null;
      
      if (!context) {
        alert('‚ùå ALBO Context Detection nicht geladen');
        return;
      }
      
      console.log('üìä Context:', context);
      
      // Show loading state
      const findingsContainer = document.getElementById('albo-findings');
      if (findingsContainer) {
        findingsContainer.innerHTML = `
          <div class="albo-placeholder">
            <div class="loading-spinner"></div>
            <p>Analysiere...</p>
          </div>
        `;
      }
      
      // TODO: Call Claude API
      setTimeout(() => {
        findingsContainer.innerHTML = `
          <div class="albo-finding">
            <div class="finding-title">‚ö†Ô∏è Demo: Analysis bereit</div>
            <div class="finding-recommendation">
              Context erkannt: ${context.view}<br>
              Claude API Integration folgt als n√§chstes!
            </div>
          </div>
        `;
      }, 1500);
    };

    // Open ALBO Chat
    window.openAlboChat = function() {
      console.log('üí¨ Opening ALBO Chat...');
      window.switchAlboTab('chat');
      
      // Focus input
      setTimeout(() => {
        const input = document.querySelector('.albo-chat-input');
        if (input) input.focus();
      }, 100);
    };

    // Send ALBO Message
    window.sendAlboMessage = function() {
      const input = document.querySelector('.albo-chat-input');
      if (!input) return;
      
      const message = input.value.trim();
      if (!message) return;
      
      console.log('üí¨ Sending message:', message);
      
      // Add user message to chat
      const messagesContainer = document.getElementById('albo-chat-messages');
      if (messagesContainer) {
        const userMsg = document.createElement('div');
        userMsg.className = 'albo-chat-message user';
        userMsg.textContent = message;
        messagesContainer.appendChild(userMsg);
        
        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
      
      // Clear input
      input.value = '';
      
      // TODO: Call Claude API
      setTimeout(() => {
        const assistantMsg = document.createElement('div');
        assistantMsg.className = 'albo-chat-message assistant';
        assistantMsg.textContent = 'ü§ñ Claude API Integration folgt als n√§chstes!';
        messagesContainer.appendChild(assistantMsg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 500);
    };

    console.log('‚úÖ ALBO Sidebar functions loaded');
    </script>

    <!-- ALBO System -->
    <script type="module" src="js/albo-init.js"></script>

</body>
</html>
